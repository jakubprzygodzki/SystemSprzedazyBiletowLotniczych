<!DOCTYPE html>
<html lang="pl">

<head>


  <link rel="stylesheet" type="text/css" href="extjs-master/build/classic/theme-classic/resources/theme-classic-all.css" />
  <script type="text/javascript" src="extjs-master/build/ext-all.js"> </script>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">

  <meta charset="UTF-8">
  <title>Przykład 37 - Minifikacja i konkatenacja skryptów</title>
  <link rel="stylesheet" href="css/main.css" />
  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
</head>

<body>

  <div id="intro">
    <img class="logoWAT" alt="WATLOGO" src="img/watLogo.jpg">

    <h1>BILETY LOTNICZE</h1>
    <h1>-WAT AIRLINES- </h1>


    <button id="registartion"> Rejestracja</button>


    <form action="http://localhost:8080/BiletyLotnicze/zaloguj.html" method="get">
      <input id="login" type="submit" value="Zaloguj">
    </form>


  </div>

  <article>

    <div id="darkLayer" class="darkClass" style="display:none"></div>

    <div id="main-form">
      <div class="inputField">
        <input id="inputFromCity" type="text" name="fromCity" placeholder=" Tu wpisz miasto startowe">
      </div>

      <div class="inputField">
        <input id="inputToCity" type="text" name="toCity" placeholder=" Tu wpisz miasto docelowe">
      </div>
      <div class="inputField">
        <input type="date" name="date">
      </div>
      <div id="buttons">
        <button id="submit" type="submit">Szukaj</button>
        <button id="cancel1" type="submit">Cancel</button>
      </div>
    </div>

  </article>
  <!--<div id="mapa"></div>-->
  <div id="added-articles" class="table">
  </div>


  <footer>

  </footer>


  <!--  <head>
        <title>login form</title>
    </head>
    <body>
        <form method="post" action="login">
        Email ID:<input type="text" name="login" /><br/>
        Password:<input type="text" name="haslo" /><br/>
        <input type="submit" value="login" />
        </form>
    </body> -->

  <script>
    czyZalogowany = function() {
      alert("musisz sie logowac");
    }


    deleteConnectionsItemsNoLogin = function() {

      var usun = document.getElementsByClassName("connectionItemNoLogin");
      var len = usun.length;
      if (usun.length != 0) {

        for (var i = 0; i < len; i++) {
          usun[0].parentNode.removeChild(usun[0]);
        }
      }
    }


    var cancel = document.getElementById("cancel1")
    cancel.addEventListener("click", deleteConnectionsItemsNoLogin, true);

    var submit = document.getElementById("submit")
    submit.addEventListener("click", sendAjax, true);



    function sendAjax() {

      var usun = document.getElementsByClassName("connectionItemNoLogin");
      if (usun.length != 0) {

        var len = usun.length;

        for (var i = 0; i < len; i++) {
          usun[0].parentNode.removeChild(usun[0]);
        }
      }

      var article = new Object();
      article.inputFromCity = $('#inputFromCity').val();
      article.inputToCity = $('#inputToCity').val();

      //var mapa = document.getElementById("mapa");
      //mapa.style.display = "block";

      $.ajax({
        url: "http://localhost:8080/BiletyLotnicze//jsonservlet",
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify(article),
        contentType: 'application/json',
        mimeType: 'application/json',

        success: function(data) {

          console.log("dataqqqqqqqqqqqqqq");
          console.log(data);
          console.log("div");
          console.log(div);

          for (var i in data) {

            var div = document.createElement("div");
            div.style.width = "700px";
            div.style.height = "22px";
            div.style.textAlign = "center";
            div.style.color = "blue";
            div.style.margin = "auto";
            div.style.marginTop = "15px";
            div.className = "connectionItemNoLogin";
            div.style.transition = "all 0.7s";
            div.title = "Musisz być zalogowany, aby przeglądać informacje o połączeniu";
            div.innerHTML = data[i].inputFromCity + " -> " + data[i].inputToCity + " " + data[i].odlot + " - " + data[i].odlot;
            document.getElementById("added-articles").appendChild(div);

            //  var aConnectionItemNoLogin = document.getElementsByClassName("connectionItemNoLogin");

            //   for(var i = 0; i < aConnectionItemNoLogin.length; i++){
            div.addEventListener("click", function() {
              showMessageBox("Musisz być zalogowany, aby wyświetlić szczegóły połączenia")
            }, true);
            // }


          }

          if (data.length == 0) {
            showMessageBox("Nie znaleziono żadnych połączeń!");
          }

        },
        error: function(data, status, er) {
          alert("error: " + data + " status: " + status + " er:" + er);
        }
      });
    }


    function initMap() {
      var uluru = {
        lat: 62.225333,
        lng: 11.019154
      };
      var map = new google.maps.Map(document.getElementById('mapa'), {
        zoom: 9,
        center: uluru
      });
      var marker = new google.maps.Marker({
        position: uluru,
        map: map
      });
    }

    goTozaloguj = function() {
      window.location.href = 'http://localhost:8080/BiletyLotnicze/zaloguj.html';
    }

    register = function() {
      var f = new Ext.FormPanel({
    	  id: 'ExtForm',
        labelWidth: 100,
        url: 'http://localhost:8080/BiletyLotnicze/zaloguj.html',
        height: 200,
        width: 300,
        frame: true,

        defaults: {
          width: 100
        },
        //applyTo: 'dlg-login-center',
        region: 'center',
        items: [{
            xtype: 'textfield',
            minWidth: 275,
            fieldLabel: 'login',
            name: 'login',
            vtype: 'login',
            id: 'loginInput'
          },
          {
            xtype: 'textfield',
            minWidth: 275,
            inputType: 'Email',
            fieldLabel: 'email',
            name: 'email',
            allowBlank: false,
            id: 'emailInput'
          },
          {
              xtype: 'textfield',
              minWidth: 275,
              inputType: 'password',
              fieldLabel: 'password',
              name: 'password',
              allowBlank: false,
              id: 'passwordInput'
            }
        ],
        buttons: [{
            text: 'Zarejestruj!',
            minWidth: 75,
            handler: function() {
            	//showMessageBox("Zarejestrowałeś się!");
            	//window.location.href = 'http://localhost:8080/BiletyLotnicze/zaloguj.html';
            	var aRegisterParmas = new Object();
 
            	
            	var sLogin = Ext.getCmp('loginInput').getValue();
            	var sEmail = Ext.getCmp('emailInput').getValue();
            	var sPassword = Ext.getCmp('passwordInput').getValue();
            	

            	aRegisterParmas.login = sLogin;
            	aRegisterParmas.email = sEmail;
            	aRegisterParmas.password = sPassword;
            	

                $.ajax({
                  url: "http://localhost:8080/BiletyLotnicze//register",
                  type: 'POST',
                  dataType: 'json',
                  data: JSON.stringify(aRegisterParmas),
                  contentType: 'application/json',
                  mimeType: 'application/json',

                  success: function(data) {

                	 console.log(data);
                	 
                	  Ext.Msg.alert('Uwaga!', data, null);
                	  
                	  //alert(data.indexOf("istnieje") );
                	  
                	  if(data.indexOf("istnieje") > -1){
                		  
                	  }
                	  else{
                		  Ext.getCmp('loginDlg').hide();
                	  }
                	  

                  },
                  error: function(data, status, er) {
                    alert("error: " + JSON.stringify(data) + " status: " + status + " er:" + er);
                  }
                });
            }
          },
          {
            text: 'Cancel',
            minWidth: 75,
            handler: function() {
              loginDlg.close()
            }
          }
        ]
      });

      var loginDlg = new Ext.Window({
        //applyTo: 'dlg-login',
        id: 'loginDlg',
        height: 300,
        width: 320,
        closable: true,
        modal: true,
        title: 'Login',
        layout: 'border',
        resizable: false,
        scrollable: true,
        items: f
      });
      loginDlg.show();
    }

    showMessageBox = function(sText) {
      Ext.Msg.alert('Uwaga!', sText, null);
    }

    //  var zaloguj = document.getElementById("zaloguj");
    //  zaloguj.addEventListener("click", goTozaloguj, true);

    var registration = document.getElementById("registartion");
    registration.addEventListener("click", register, true);
  </script>

  <!-- <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBecyC_LYfo2Uo1GDB-RwKpyrBU5MYYgVc&callback=initMap">
    </script>
      -->

</body>

</html>
