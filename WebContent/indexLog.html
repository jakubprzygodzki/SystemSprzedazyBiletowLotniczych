<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="UTF-8">


  <!--     <link rel = "stylesheet" type = "text/css"
         href = "https://cdnjs.cloudflare.com/ajax/libs/extjs/6.0.0/classic/theme-gray/resources/theme-gray-all.css" / >
      <script type = "text/javascript"
         src = "https://cdnjs.cloudflare.com/ajax/libs/extjs/6.0.0/ext-all.js"> </script>
      <script type = "text/javascript" src = "app.js" > </script>    -->



  <!--    <link rel = "stylesheet" type = "text/css"
         href = "ext-6.6.0/build/classic/theme-classic/resources/theme-classic-all.css" />
      <script type = "text/javascript" src = "ext-6.6.0/build/ext-all.js" > </script>   -->


  <link rel="stylesheet" type="text/css" href="extjs-master/build/classic/theme-classic/resources/theme-classic-all.css" />
  <script type="text/javascript" src="extjs-master/build/ext-all.js"> </script>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">

  <title>Przykład 37 - Minifikacja i konkatenacja skryptów</title>
  <link rel="stylesheet" href="css/main.css" />
  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
</head>

<body>

  <div id="intro">
    <button id="zaloguj">Zaloguj sie</button>
    <button>Rejestracja</button>

    <h1>BILETY LOTNICZE</h1>
    <h1>-WAT AIRLINES-</h1>
  </div>


  <form action="http://localhost:8080/BiletyLotnicze/wyloguj" method="get">
    <input type="submit" value="Wyloguj">
  </form>


  <article>

    <div id="darkLayer" class="darkClass" style="display:none"></div>

    <div id="main-form">
      <div class="inputField">
        <input id="inputFromCity" type="text" name="fromCity" placeholder=" Tu wpisz miasto startowe">
      </div>

      <div class="inputField">
        <input id="inputToCity" type="text" name="toCity" placeholder=" Tu wpisz miasto docelowe">
      </div>

      <div id="buttons">
        <button id="submit" type="submit">Szukaj</button>
        <button id="deleteConnectionsItems" type="submit">Cancel</button>
      </div>
    </div>

  </article>
  <form action="http://localhost:8080/BiletyLotnicze//dowloadTicket" method='POST' id='formid'>
                <input type='hidden' value='' name='name' id='name'/>
                <input type='hidden' value=' ' name='lastname'  id='lastName' />
                <input type='hidden' value=' ' name='lastname'  id='pesel' />
                <input type='hidden' value=' ' name='lastname'  id='arrivalTime' />
                <input type='hidden' value=' ' name='lastname'  id='departureTime' />
                <input type='hidden' value=' ' name='lastname'  id='arrivalPlace' />
                <input type='hidden' value=' ' name='lastname'  id='departurePlace' />
                <input type='hidden' value=' ' name='lastname'  id='seatNumber' />
            </form>
  <!--<div id="mapa"></div>-->
  <div id="added-articles" class="table">
  </div>

  <!--  <head>
        <title>login form</title>
    </head>
    <body>
        <form method="post" action="login">
        Email ID:<input type="text" name="login" /><br/>
        Password:<input type="text" name="haslo" /><br/>
        <input type="submit" value="login" />
        </form>
    </body> -->

  <script>




    //------------------------------------------------------------------------------
    showBuyTicketForm = function(aTicketData, aWindow1) {
      //------------------------------------------------------------------------------

      console.log("Windos1");
      console.log(aWindow1);

      aWindow1.hide();

      var div = document.createElement("div");
      var h3 = document.createElement("h3");
      var h3Arrival = document.createElement("h3");
      var h3Departure = document.createElement("h3");

      var h3ArrivalTime = document.createElement("h3");
      var h3DepartureTime = document.createElement("h3");
      var h4Imie = document.createElement("h4");
      var h4Nazwisko = document.createElement("h4");
      var h4Pesel = document.createElement("h4");

      h3.innerHTML = "Nr miesjca: " + aTicketData.seatNumber + "</br";
      h3Arrival.innerHTML = "Skąd: " + aTicketData.fromCity;
      h3Departure.innerHTML = "Dokąd: " + aTicketData.toCity;
      h3ArrivalTime.innerHTML = "Godzina odlotu: " + aTicketData.odlot;

      h3DepartureTime.innerHTML = "Godzina przylotu: " + aTicketData.odlot;
      h4Imie.innerHTML = "Imię";
      h4Nazwisko.innerHTML = "Nazwisko";
      h4Pesel.innerHTML = "PESEL";

      var input1 = document.createElement("input");
      var input2 = document.createElement("input");
      var input3 = document.createElement("input");
      
      input1.id = "inputName";
      input2.id = "inputLastName";
      input3.id = "inputPESEL";
      
      
      div.appendChild(h3);
      div.appendChild(h3Arrival);
      div.appendChild(h3Departure);

      div.appendChild(h3ArrivalTime);
      div.appendChild(h3DepartureTime);

      div.appendChild(h4Imie);
      div.appendChild(input1);

      div.appendChild(h4Nazwisko);
      div.appendChild(input2);

      div.appendChild(h4Pesel);
      div.appendChild(input3);


      dupa2= function() {
    	  
    	  var aTicket = new Object();
    	  
    	  aTicket.inputName = document.getElementById('inputName').value;
    	  aTicket.inputLastName = document.getElementById('inputLastName').value;
    	  aTicket.inputPESEL = document.getElementById('inputPESEL').value;
 

    	  document.getElementById('name').value = aTicket.inputName;
    	  document.getElementById('lastName').value = aTicket.inputLastName;
    	  document.getElementById('pesel').value = aTicket.inputPESEL;
    	  
    	  document.getElementById('arrivalTime').value = aTicketData.odlot;
    	  document.getElementById('departureTime').value = aTicketData.odlot;
    	  document.getElementById('arrivalPlace').value = aTicketData.fromCity;
    	  document.getElementById('departurePlace').value = aTicketData.toCity;
    	  document.getElementById('seatNumber').value = aTicketData.seatNumber;

        $('#formid').submit();
      }



      var aWindow2 = Ext.create('Ext.window.Window', {
        title: 'Formularz zakupu biletu',
        height: 600,
        width: 500,
        layout: 'fit',
        html: div.innerHTML,
        buttons: [{
          text: 'Pobierz bilet',
          handler: dupa2
        }]
      });

      aWindow2.show();

      return;
    }



    //------------------------------------------------------------------------------
    deleteWindow = function(okno) {
      //------------------------------------------------------------------------------
      okno.parentNode.removeChild(okno);
      var t = document.getElementById("darkLayer");
      t.style.display = "none";
      return;
    }


    //------------------------------------------------------------------------------
    function pobierzMiejsca(aParams) {
      //------------------------------------------------------------------------------

      var aID = {
        nr: aParams.flightID
      };
      $.ajax({
        url: "http://localhost:8080/BiletyLotnicze//seats",
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify(aID),
        contentType: 'application/json',
        mimeType: 'application/json',

        success: function(data) {

          var aWindow1;

          var divContainer = document.createElement("div");

          divContainer.style.display = "none";

          //document.getElementsByTagName("body")[0].appendChild(divContainer);

          for (var i in data) {

            console.log("data[i]");
            console.log(data[i]);


            var div = document.createElement("div");
            div.className = "seat";
            div.minWidth = "100px";
            div.minHeight = "50px";
            div.background = " blue";

            div.innerHTML = "<i class=\"fas fa-chair\"></i></br>" + data[i].nr;;
            //div.innerHTML += data[i].nr;
            div.style.zIndex = "100";
            div.id = data[i].nr;

            divContainer.appendChild(div);



            //  var siedzenie;
            if (data[i].available == "0") {
              //siedzenie = document.getElementById(data[i].nr);
              div.classList.add("freeSeat");
            } else {
              //siedzenie = document.getElementById(data[i].nr);
              div.classList.add("noAvailable");
            }

          }



          aWindow1 = Ext.create('Ext.window.Window', {
            title: 'Wybierz miejsce',
            height: 600,
            width: 350,
            layout: 'fit',
            resizable: false,
            scrollable: true,
            html: divContainer.innerHTML,
            // buttons: [{
            //   text: 'Dostępne miejsca',
            //   handler: dupa
            // }]
          });
          //console.log(aWindow1.body);
          aWindow1.show();


          for (var i = 0; i < aWindow1.body.el.dom.childNodes.length; i++) {

            aWindow1.body.el.dom.childNodes[i].addEventListener("click", function(e) {
              //
              aParams.seatNumber = e.target.id;
              //alert(aParams.seatNumber);
              if (e.target.className.indexOf("noAvailable") != -1) {
                alert("To miejsce jest niedostępne");
                return;
              }
              showBuyTicketForm(aParams, aWindow1);

            }, false);
          }

          //document.getElementById("2").;

          //  var btn = document.createElement("BUTTON");
          //  btn.innerHTML = "cancel";

          //    document.getElementsByClassName("pulpit")[0].appendChild(btn);

          //  var okno = document.getElementsByClassName("pulpit")[0];


          //    var t = document.getElementById("darkLayer");
          //  t.style.display = "block";

          // btn.addEventListener("click", function() {
          //   console.log(okno);
          //   deleteWindow(okno);
          // }, true);



        },
        error: function(data, status, er) {
          alert("error: " + data + " status: " + status + " er:" + er);
        }
      });
    }


    //------------------------------------------------------------------------------
    showPlaneSchedule = function(aParams) {
      //------------------------------------------------------------------------------
      //var sID = aParams.flightID;
      // var div = document.createElement("div");
      // div.className = "pulpit";
      // var divMiejsce = document.createElement("div");
      // divMiejsce.className = "pulpit";
      // divMiejsce.innerHTML = "asdas";
      //
      // document.getElementsByTagName("body")[0].appendChild(div);
      // console.log("aParams");
      // console.log(aParams);
      var t = pobierzMiejsca(aParams);

      return;
    }

    //------------------------------------------------------------------------------
    deleteConnectionsItems = function() {
      //------------------------------------------------------------------------------
      var usun = document.getElementsByClassName("connectionItem");
      var len = usun.length;
      if (usun.length != 0) {

        for (var i = 0; i < len; i++) {
          usun[0].parentNode.removeChild(usun[0]);
        }
      }
    }

    //------------------------------------------------------------------------------
    searchConnections = function() {
      //------------------------------------------------------------------------------
      var usun = document.getElementsByClassName("connectionItem");

      if (usun.length != 0) {
        var len = usun.length;
        for (var i = 0; i < len; i++) {
          usun[0].parentNode.removeChild(usun[0]);
        }
      }

      var article = new Object();
      article.inputFromCity = $('#inputFromCity').val();
      article.inputToCity = $('#inputToCity').val();

      //var mapa = document.getElementById("mapa");
      //mapa.style.display = "block";

      $.ajax({
        url: "http://localhost:8080/BiletyLotnicze//jsonservlet",
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify(article),
        contentType: 'application/json',
        mimeType: 'application/json',

        success: function(data) {

          console.log("dataqqqqqqqqqqqqqq");
          console.log(data);
          console.log("div");
          console.log(div);

          var sArrayOfIDsOfFlights = [];
          for (var i in data) {

            console.log(data[i]);

            var div = document.createElement("div");
            div.id = data[i].IDLotu;
            div.style.width = "700px";
            div.style.height = "22px";
            div.style.textAlign = "center";
            div.style.margin = "auto";
            div.style.marginTop = "15px";
            div.className = "connectionItem";
            div.style.transition = "all 0.7s";
            div.innerHTML = data[i].inputFromCity + " -> " + data[i].inputToCity + " " + data[i].odlot + " - " + data[i].odlot + " , id: " + data[i].IDLotu;
            div.infoAttributes = {
              flightID: data[i].IDLotu,
              fromCity: data[i].inputFromCity,
              toCity: data[i].inputToCity,
              arrival: data[i].odlot
            };


            document.getElementById("added-articles").appendChild(div);

            div.addEventListener("click", function(e) {
              console.log("e");
              console.log(e.target.infoAttributes);
              //alert(e.target.id);
              showPlaneSchedule(e.target.infoAttributes);
            }, false)

          }
        },
        error: function(data, status, er) {
          alert("error: " + data + " status: " + status + " er:" + er);
        }
      });
    }

    //------------------------------------------------------------------------------
    initMap = function() {
      //------------------------------------------------------------------------------
      var uluru = {
        lat: 62.225333,
        lng: 11.019154
      };
      var map = new google.maps.Map(document.getElementById('mapa'), {
        zoom: 9,
        center: uluru
      });
      var marker = new google.maps.Marker({
        position: uluru,
        map: map
      });
    }



    var deleteConnectionsItems = document.getElementById("deleteConnectionsItems")
    deleteConnectionsItems.addEventListener("click", deleteConnectionsItems, true);

    var submit = document.getElementById("submit")
    submit.addEventListener("click", searchConnections, true);
  </script>

  <!-- <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBecyC_LYfo2Uo1GDB-RwKpyrBU5MYYgVc&callback=initMap">
    </script>
      -->

</body>

</html>
